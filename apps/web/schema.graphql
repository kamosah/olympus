schema {
  query: Query
  mutation: Mutation
}

input AddOrganizationMemberInput {
  organizationId: ID!
  role: OrganizationRole! = MEMBER
  userId: ID!
}

input CreateOrganizationInput {
  description: String = null
  name: String!
  slug: String = null
}

input CreateSpaceInput {
  description: String = null
  iconColor: String = null
  name: String!
  organizationId: ID!
}

input CreateThreadInput {
  confidenceScore: Float = null
  organizationId: ID!
  queryText: String!
  result: String = null
  spaceId: ID = null
  title: String = null
}

input CreateUserInput {
  avatarUrl: String = null
  bio: String = null
  email: String!
  fullName: String = null
}

type DashboardStats {
  threadsThisMonth: Int!
  totalDocuments: Int!
  totalSpaces: Int!
  totalThreads: Int!
}

"""Date with time (isoformat)"""
scalar DateTime

type Document {
  createdAt: DateTime!
  docMetadata: JSON
  extractedText: String
  filePath: String!
  fileType: String!
  id: ID!
  name: String!
  processedAt: DateTime
  processingError: String
  sizeBytes: Int!
  spaceId: ID!
  status: String!
  updatedAt: DateTime!
  uploadedBy: ID!
}

type DocumentChunk {
  chunkIndex: Int!
  chunkMetadata: JSON!
  chunkText: String!
  createdAt: DateTime!
  documentId: ID!
  endChar: Int!
  id: ID!
  startChar: Int!
  tokenCount: Int!
}

"""
The `JSON` scalar type represents JSON values as specified by [ECMA-404](https://ecma-international.org/wp-content/uploads/ECMA-404_2nd_edition_december_2017.pdf).
"""
scalar JSON

type Mutation {
  addOrganizationMember(input: AddOrganizationMemberInput!): OrganizationMember!
  createOrganization(input: CreateOrganizationInput!): Organization!
  createSpace(input: CreateSpaceInput!): Space!
  createThread(input: CreateThreadInput!): Thread
  createUser(input: CreateUserInput!): User!
  deleteOrganization(id: ID!): Boolean!
  deleteSpace(id: ID!): Boolean!
  deleteThread(id: ID!): Boolean!
  deleteUser(id: ID!): Boolean!
  removeOrganizationMember(organizationId: ID!, userId: ID!): Boolean!
  updateMemberRole(organizationId: ID!, role: OrganizationRole!, userId: ID!): OrganizationMember
  updateOrganization(id: ID!, input: UpdateOrganizationInput!): Organization
  updateSpace(id: ID!, input: UpdateSpaceInput!): Space
  updateThread(id: ID!, input: UpdateThreadInput!): Thread
  updateUser(id: ID!, input: UpdateUserInput!): User
}

type Organization {
  createdAt: DateTime!
  description: String
  id: ID!
  memberCount: Int!
  name: String!
  ownerId: ID
  slug: String!
  spaceCount: Int!
  threadCount: Int!
  updatedAt: DateTime!
}

type OrganizationMember {
  createdAt: DateTime!
  id: ID!
  organizationId: ID!
  role: OrganizationRole!
  user: User
  userId: ID!
}

enum OrganizationRole {
  ADMIN
  MEMBER
  OWNER
  VIEWER
}

type Query {
  dashboardStats(organizationId: ID = null): DashboardStats!
  documents(limit: Int! = 100, offset: Int! = 0, spaceId: ID = null): [Document!]!
  health: String!
  organization(id: ID!): Organization
  organizationMembers(limit: Int! = 50, offset: Int! = 0, organizationId: ID!): [OrganizationMember!]!
  organizations(limit: Int! = 10, offset: Int! = 0): [Organization!]!
  searchDocuments(input: SearchDocumentsInput!): [SearchResult!]!
  space(id: ID!): Space
  spaces(limit: Int! = 10, offset: Int! = 0): [Space!]!
  thread(id: ID!): Thread
  threads(limit: Int! = 50, offset: Int! = 0, organizationId: ID = null, spaceId: ID = null): [Thread!]!
  user(id: ID!): User
  userByEmail(email: String!): User
  users(limit: Int! = 10, offset: Int! = 0): [User!]!
}

input SearchDocumentsInput {
  documentIds: [ID!] = null
  limit: Int! = 10
  query: String!
  similarityThreshold: Float! = 0
  spaceId: ID = null
}

type SearchResult {
  chunk: DocumentChunk!
  distance: Float!
  document: Document!
  similarityScore: Float!
}

type Space {
  createdAt: DateTime!
  description: String
  documentCount: Int!
  iconColor: String
  id: ID!
  isPublic: Boolean!
  maxMembers: Int
  memberCount: Int!
  name: String!
  ownerId: ID!
  slug: String!
  updatedAt: DateTime!
}

type Thread {
  agentSteps: JSON
  completedAt: DateTime
  confidenceScore: Float
  context: String
  costUsd: Float
  createdAt: DateTime!
  createdBy: ID!
  errorMessage: String
  id: ID!
  modelUsed: String
  organizationId: ID!
  processingTimeMs: Int
  queryText: String!
  result: String
  sources: JSON
  spaceId: ID
  status: ThreadStatusEnum
  title: String
  tokensUsed: Int
  updatedAt: DateTime!
}

enum ThreadStatusEnum {
  COMPLETED
  FAILED
  PENDING
  PROCESSING
}

input UpdateOrganizationInput {
  description: String = null
  name: String = null
}

input UpdateSpaceInput {
  description: String = null
  iconColor: String = null
  name: String = null
}

input UpdateThreadInput {
  result: String = null
  title: String = null
}

input UpdateUserInput {
  avatarUrl: String = null
  bio: String = null
  fullName: String = null
}

type User {
  avatarUrl: String
  bio: String
  createdAt: DateTime!
  email: String!
  fullName: String
  id: ID!
  updatedAt: DateTime!
}